<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phonebook</title>
    <script src="https://kit.fontawesome.com/6bf8df2f4a.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="../public/css/shop.css">
    <link rel="stylesheet" type="text/css" href="../public/css/nav-bar.css">
    <link rel="stylesheet" type="text/css" href="../public/css/footer.css">
    <script
    src="https://code.jquery.com/jquery-3.7.0.js"
    integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM="
    crossorigin="anonymous"></script>
</head>
<body>
 <!------menu-bar------->
 <nav>
    <div class="navigation">
    <!-- logo-->
    <a href="#" class="logo">
        <img src="../public/img/logo.png"/>
    </a>
     <!--menu-->
     <ul class ="menu">
        <li><a href="#" class="sign-in">Sign In</a></li>
        <li><a href="#" class="sign-up">Sign Up</a></li>
        <li id="logout" style="display: none;"><a href="#" class="logout">Log Out</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="mainPage.html">Home</a></li>
        <li><a href="chatEntrace.html">Chat</a></li>
     </ul>
     <div class="right-menu">
             <!--user-->
             <a href="#" class="user">
                <i class="fas fa-user"></i>
            </a>
             <!--cart-icon-->
             <a href="../views/cart.html">
                <i class="fas fa-shopping-cart">
                <!--number of products in cart-->
                <span class="num-cart-producuts">0</span>
                </i>
            </a>
     </div>
  </div>
</nav>

<div class="user-popup">
    <ul class="user-popup-menu">
      <li><a href="../views/history.html">History</a></li>
      <li><a href="../views/cart.html">Cart</a></li>
      <li><a href="#" class="logout">Logout</a></li>
    </ul>
  </div>

      <!--login and signup form-->
<div class="form">
    <!--login-->
    <div class="login-form">
        <a href="#" class="form-cancel">
            <i class="fas fa-times"></i>
        </a>
        <strong>Sign In</strong>
        <form id="login">
            <input type="email" placeholder="Example@gmail.com" name="email">
            <input type="password" placeholder="Password" name="password">
            <input type="submit" value="Sign In">
        </form>
        <div class="form-btns">
            <a href="#" class="sign-up-btn">Create Account</a>
        </div>
    </div>


     <!--Sign Up-->
     <div class="sign-up-form">
        <a href="#" class="form-cancel">
            <i class="fas fa-times"></i>
        </a>
        <strong>Sign Up</strong>
        <form id="register">
            <input type="text" placeholder="Full Name" name="name" required>
            <input type="email" placeholder="Example@gmail.com" name="email" required>
            <input type="password" placeholder="Password" name="password" const packageName = require('packageName');>
            <input type="submit" value="Sign Up">
            <!-- Inside the registration form -->
            <div class="registration-success-message" style="color: green;"></div>
            <div class="registration-error-message" style="color: red;"></div>
        </form>
        <div class="form-btns">
            <a href="#" class="already-account">Already have an account?</a>
        </div>
    </div>
</div>


<h2 class="shop-header">Featured Products:</h2>

<section class="price-range">
<div class="wrapper">
    <header>
    <h2>Price Range</h2>
    <p>User silder or enter min and max price</p>
    </header>
<div class="price-input">
    <div class="field">
        <span>Min</span>
        <input type="number" class="input-min" value="0">
    </div>
    <div class="separator">-</div>
    <div class="field">
        <span>Max</span>
        <input type="number" class="input-max" value="16000">
    </div>
</div>
<div class="slider">
    <div class="progress"></div>
 </div>
 <div class="range-input">
    <input type="range" class="range-min" min="0" max="16000" value="2500" step="100">
    <input type="range" class="range-max" min="0" max="16000" value="7500" step="100">
 </div>
</div>
</section>


<section id="filter-category">
    <div id="button-container2">
        <button class="btn active" value="all">Show all</button>
        <button class="btn" value="Phones">Phones</button>
        <button class="btn" value="laptops">Laptops</button>
    </div>
</section>

<section id="filter-buttons">
    <div id="button-container">
        <button class="btn active" data-filter-type="brand" value="all">Show all</button>
        <button class="btn" data-filter-type="brand" value="Samsung">Samsung</button>
        <button class="btn" data-filter-type="brand" value="Apple">Apple</button>
        <button class="btn" data-filter-type="brand" value="Realme">Realme</button>
        <button class="btn" data-filter-type="brand" value="OnePlus">OnePlus</button>
        <button class="btn" data-filter-type="brand" value="Asus">Asus</button>
    </div>
</section>


<section class="shop-display">
    <div class="product-container">
    </div>
    <!-- Product boxes will be generated dynamically by JavaScript -->
</section>



        <section id="pagination" class="section-pp1">
            <a href="#">1</a>
            <a href="#">2</a>
            <a href="#"><i class="fas fa-long-arrow-alt-right"></i></a>
        </section>
    

    <section class="buttom-footer">
      <footer class="section-p1">
        <div class="col">
            <img src ="../public/img/logo.png" alt="" class="footer-logo">
            <h4>Contact</h4>
            <p><strong>Adress:</strong> Wiesel St 2, Rishon LeTsiyon</p>
            <p><strong>Phone:</strong> +972 52 8090 777 </p>
            <p><strong>Hours:</strong> 10:00-20:00, Sun-Fri</p>
            <div class="follow">
                <h4>Follow Us:</h4>
                <div class ="social-icon">
                    <i class="fab fa-facebook"></i>
                    <i class="fab fa-twitter"></i>
                    <i class="fab fa-instagram"></i>
                    <i class="fab fa-pinterest"></i>
                    <i class="fab fa-youtube"></i>
                </div>
            </div>
        </div>

        <div class="col">
            <h4><strong>About</strong></h4>
            <a href="#">About Us</a>
            <a href="#">Delivery Information</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Term & Conditions</a>
            <a href="#">Contact Us</a>
        </div>

        <div class="col">
            <h4><strong>My Account</strong></h4>
            <a href="#">Sign In</a>
            <a href="#">View Cart</a>
            <a href="#">My Wishlist</a>
            <a href="#">Track My order</a>
            <a href="#">Help</a>
        </div>

        <div class="col install">
            <h4><strong>Install App</strong></h4>
            <p>From App Store or Google Play</p>
            <div class="row">
                <img src="../public/img/app.jpg" alt="">
                <img src="../public/img/play.jpg" alt="">
            </div>
            <p>Secured Payment Gateways</p>
            <img src="../public/img/pay.png" alt="">
        </div>

        <div class="copyright">
            <p>&copy; 2023 Zigel&Or PHONEBOOK - Digital Shop</p>
        </div>
      </footer>
    </section>


    <script src="../public/js/nav-bar.js"></script>
    <script>
        $(document).ready(function() {
            const jwtToken = localStorage.getItem('token'); // Replace with your actual JWT token
            const productData = [];
    
            // Function to fetch products and generate product boxes
            async function fetchAndGenerateProductBoxes(brand) {
                try {
                    let url = 'http://localhost:3000/api/v1/products';
                    if (brand) {
                        url = `http://localhost:3000/api/v1/products/byBrand?brand=${brand}`;
                    }
    
                    const response = await fetch(url, {
                        headers: {
                            Authorization: `Bearer ${jwtToken}`
                        }
                    });
                    const data = await response.json();
    
                    if (response.ok) {
                        const productContainer = document.querySelector('.product-container');
                        productContainer.innerHTML = ''; // Clear existing content
    
                        data.forEach(product => {
                            const productBox = document.createElement('div');
                            productBox.className = 'product-box';
                            productBox.setAttribute('data-product-id', product.id);
                            productBox.innerHTML = `
                                <div class="product-img">
                                    <a href="#" class="add-cart"><i class="fas fa-shopping-cart"></i></a>
                                    <img src="${product.image}">
                                </div>
                                <div class="product-details">
                                    <a href="#" class="p-name">${product.name}</a>
                                    <span class="p-price">₪${product.price.toLocaleString()} </span>
                                </div>
                            `;
                            productContainer.appendChild(productBox);
    
                            // Store product ID and name in the array
                            productData.push({ id: product.id, name: product.name });
                        });
    
                        // Add a click event listener to the product boxes
                        $('.product-box').on('click', function() {
                            const productId = $(this).data('product-id');
                            // Find the product name by matching the ID
                            const productName = productData.find(product => product.id === productId)?.name;
                            if (productName) {
                                window.location.href = `sproduct.html?id=${productId}`;
                            }
                        });
                    } else {
                        console.error('Failed to fetch products');
                    }
                } catch (error) {
                    console.error('Error fetching products:', error);
                }
            }
    
            // Add click event listeners to the filter buttons
            const filterButtons = document.querySelectorAll('.btn');
    
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const brand = button.textContent.trim();
                    fetchAndGenerateProductBoxes(brand === 'Show all' ? null : brand);
    
                    // Remove 'active' class from other buttons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
    
                    // Add 'active' class to the clicked button
                    button.classList.add('active');
                });
            });
    
            // Display all products initially
            fetchAndGenerateProductBoxes(null);
        });
    </script>
  

<script>
  $(document).ready(function() {
    const jwtToken = localStorage.getItem('token');
    const productData = [];

    async function fetchAndGenerateProductBoxes(category) {
        try {
            let url = 'http://localhost:3000/api/v1/products';

            if (category && category !== 'all') {
                url = `http://localhost:3000/api/v1/products/byCategory?categories=${category}`;
            }

            const response = await fetch(url, {
                headers: {
                    Authorization: `Bearer ${jwtToken}`
                }
            });

            if (response.ok) {
                const data = await response.json();
                const productContainer = document.querySelector('.product-container');
                productContainer.innerHTML = '';

                data.forEach(product => {
                    const productBox = document.createElement('div');
                    productBox.className = 'product-box';
                    productBox.setAttribute('data-product-id', product.id);
                    productBox.innerHTML = `
                        <div class="product-img">
                            <a href="#" class="add-cart"><i class="fas fa-shopping-cart"></i></a>
                            <img src="${product.image}">
                        </div>
                        <div class="product-details">
                            <a href="#" class="p-name">${product.name}</a>
                            <span class="p-price">₪${product.price.toLocaleString()} </span>
                        </div>
                    `;
                    productContainer.appendChild(productBox);
                });

                productData.push(...data.map(product => ({ id: product.id, name: product.name })));
                
                $('.product-box').on('click', function() {
                    const productId = $(this).data('product-id');
                    const productName = productData.find(product => product.id === productId)?.name;
                    if (productName) {
                        window.location.href = `sproduct.html?id=${productId}`;
                    }
                });
            } else {
                console.error('Failed to fetch products');
            }
        } catch (error) {
            console.error('Error fetching products:', error);
        }
    }

    const categoryButtons = document.querySelectorAll('#button-container2 .btn');

    categoryButtons.forEach(button => {
        button.addEventListener('click', () => {
            const category = button.value;
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            fetchAndGenerateProductBoxes(category);
        });
    });

    fetchAndGenerateProductBoxes(null);
});

</script>
    
<!--Price Range Script
    <script>
        const rangeInput = document.querySelectorAll(".range-input input"),
        priceInput = document.querySelectorAll(".price-input input"),
        progress = document.querySelector(".slider .progress");

        let PriceGap = 1000;


        rangeInput.forEach(input =>{
            input.addEventListener("input",(e)=>{
                //getting two ranges value and parsing them to number
                let minVal = parseInt(rangeInput[0].value),
                maxVal = parseInt(rangeInput[1].value);

                if(maxVal -minVal<PriceGap){
                    if(e.target.className ==="range-min"){
                        rangeInput[0].value = maxVal - PriceGap;
                    }
                    else{
                        rangeInput[1].value = minVal + PriceGap;
                    }
                }
                else{
                    priceInput[0].value = minVal;
                    priceInput[1].value = maxVal;
                    progress.style.left = (minVal / rangeInput[0].max)*100 +"%";
                    progress.style.right = 100 - (maxVal / rangeInput[1].max)*100 +"%";
                }
            });
        });


        priceInput.forEach(input =>{
            input.addEventListener("input",(e)=>{
                //getting two inputs value and parsing them to number
                let minVal = parseInt(priceInput[0].value),
                maxVal = parseInt(priceInput[1].value);

                if((maxVal - minVal >= PriceGap) && maxVal <= 16000){
                    if(e.target.className ==="input-min"){
                        rangeInput[0].value = minVal;
                        progress.style.left = (minVal / rangeInput[0].max)*100 +"%";
                    }
                    else{
                        rangeInput[1].value = maxVal;
                        progress.style.right = 100 - (maxVal / rangeInput[1].max)*100 +"%";
                    }
                }
            });
        });
    </script>
    -->

    <!--Price Range Script-->
    <script>
        $(document).ready(function() {
            const rangeInput = document.querySelectorAll(".range-input input");
            const priceInput = document.querySelectorAll(".price-input input");
            const progress = document.querySelector(".slider .progress");
            const productContainer = document.querySelector('.product-container');
    
            let PriceGap = 1000;
    
            // Function to fetch products based on price range
            function fetchProductsByPriceRange(minPrice, maxPrice) {
                const url = `http://localhost:3000/api/v1/products/getProductsByPriceRange?min=${minPrice}&max=${maxPrice}`;
    
                $.get(url, function(data) {
                    // Clear the existing products in the container
                    productContainer.innerHTML = "";
    
                    data.forEach(product => {
                        const productBox = document.createElement('div');
                        productBox.className = 'product-box';
                        productBox.setAttribute('data-product-id', product.id);
                        productBox.innerHTML = `
                            <div class="product-img">
                                <a href="#" class="add-cart"><i class="fas fa-shopping-cart"></i></a>
                                <img src="${product.image}">
                            </div>
                            <div class="product-details">
                                <a href="#" class="p-name">${product.name}</a>
                                <span class="p-price">₪${product.price.toLocaleString()} </span>
                            </div>
                        `;
                        productContainer.appendChild(productBox);
                    });
                });
            }
    
            rangeInput.forEach(input => {
                input.addEventListener("input", (e) => {
                    let minVal = parseInt(rangeInput[0].value),
                        maxVal = parseInt(rangeInput[1].value);
    
                    if (maxVal - minVal < PriceGap) {
                        if (e.target.className === "range-min") {
                            rangeInput[0].value = maxVal - PriceGap;
                        } else {
                            rangeInput[1].value = minVal + PriceGap;
                        }
                    } else {
                        priceInput[0].value = minVal;
                        priceInput[1].value = maxVal;
                        progress.style.left = (minVal / rangeInput[0].max) * 100 + "%";
                        progress.style.right = 100 - (maxVal / rangeInput[1].max) * 100 + "%";
    
                        // Fetch products based on the updated price range
                        fetchProductsByPriceRange(minVal, maxVal);
                    }
                });
            });
    
            priceInput.forEach(input => {
                input.addEventListener("input", (e) => {
                    let minVal = parseInt(priceInput[0].value),
                        maxVal = parseInt(priceInput[1].value);
    
                    if ((maxVal - minVal >= PriceGap) && maxVal <= 16000) {
                        if (e.target.className === "input-min") {
                            rangeInput[0].value = minVal;
                            progress.style.left = (minVal / rangeInput[0].max) * 100 + "%";
                        } else {
                            rangeInput[1].value = maxVal;
                            progress.style.right = 100 - (maxVal / rangeInput[1].max) * 100 + "%";
                        }
    
                        // Fetch products based on the updated price range
                        fetchProductsByPriceRange(minVal, maxVal);
                    }
                });
            });
        });
    </script>
    

    
    
    
      
</body>
</html>