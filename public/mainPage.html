<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phonebook</title>
    <script src="https://kit.fontawesome.com/6bf8df2f4a.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="css/mainPage.css"
    <link rel="stylesheet" type="text/css" href="css/lightslider.css"

</head>
<body>
    <!------menu-bar------->
    <nav>
        <div class="navigation">
        <!-- logo-->
        <a href="#" class="logo">
            <img src="images/logo.png"/>
        </a>
         <!--menu-->
         <ul class ="menu">
            <li><a href="#" class="sign-in">Sign In</a></li>
            <li><a href="#" class="sign-up">Sign Up</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Shop</a></li>
            <li><a href="#">Home</a></li>
         </ul>
         <div class="right-menu">
                <!--search-->
                <a href="#" class="search">
                    <i class="fa-solid fa-search"></i>
                </a>
                 <!--user-->
                 <a href="#" class="user">
                    <i class="fas fa-user"></i>
                </a>
                 <!--cart-icon-->
                 <a href="#">
                    <i class="fas fa-shopping-cart">
                    <!--number of products in cart-->
                    <span class="num-cart-producuts">0</span>
                    </i>
                </a>
         </div>
      </div>
    </nav>

    <!--search-bar-------------------------->
    <div class="search-bar">
        <!--search-input--->
        <div class="search-input">
            <!--input-->
            <input type="text" placeholder="Search For Product"/>
            <!--cancel button-->
            <a href="#" class="search-cancel">
                <i class="fas fa-times"></i>
            </a>
        </div>
    </div>

    <!--login and signup form-->
    <div class="form">
        <!--login-->
        <div class="login-form">
            <a href="#" class="form-cancel">
                <i class="fas fa-times"></i>
            </a>
            <strong>Sign In</strong>
            <form id="login">
                <input type="email" placeholder="Example@gmail.com" name="email">
                <input type="password" placeholder="Password" name="password">
                <input type="submit" value="Sign In">
            </form>
            <div class="form-btns">
                <a href="#" class="sign-up-btn">Create Account</a>
            </div>
        </div>


         <!--Sign Up-->
         <div class="sign-up-form">
            <a href="#" class="form-cancel">
                <i class="fas fa-times"></i>
            </a>
            <strong>Sign Up</strong>
            <form id="register">
                <input type="text" placeholder="Full Name" name="name" required>
                <input type="email" placeholder="Example@gmail.com" name="email" required>
                <input type="password" placeholder="Password" name="password" const packageName = require('packageName');>
                <input type="submit" value="Sign Up">
            </form>
            <div class="form-btns">
                <a href="#" class="already-account">Already have an account?</a>
            </div>
        </div>
    </div>


    <!--Full slider-->
    <!--box-1-->
        <ul id="adaptive" class="cs-hidden">
            <li class="item-a">
            <div class="full-slider-box f-slide-1">
                <!--slider text container-->
                <div class="slider-text-container">
                    <div class ="f-slider-text"
                    <span>Limited offer</span>
                    <strong>15% off <br/> with <font>promo code</font></strong>
                    <a href="#" class="f-slider-btn">Shop now</a>
                    </div>
                </div>
            </div>
            </li>

         <!--box-2-->
            <li class="item-b">
                <div class="full-slider-box f-slide-2">
                    <!--slider text container-->
                    <div class="slider-text-container">
                        <div class ="f-slider-text"
                        <span>Limited offer</span>
                        <strong>15% off <br/> with <font>promo code</font></strong>
                        <a href="#" class="f-slider-btn">Shop now</a>
                        </div>
                    </div>
                </div>
                </li>

             <!--box-3-->
                <li class="item-c">
                    <div class="full-slider-box f-slide-3">
                        <!--slider text container-->
                        <div class="slider-text-container">
                            <div class ="f-slider-text"
                            <span>Limited offer</span>
                            <strong>15% off <br/> with <font>promo code</font></strong>
                            <a href="#" class="f-slider-btn">Shop now</a>
                            </div>
                        </div>
                    </div>
                    </li>
        </ul>



    <!--JQuery------->
    <script src="../jquery.js"></script>
    <script type="text/javascript">
        // Search Bar
        $(document).on('click','.search',function(){
            $('.search-bar').addClass('search-bar-active')
        });

        $(document).on('click','.search-cancel',function(){
            $('.search-bar').removeClass('search-bar-active')
        });

        // Login and Signup Form
        $(document).on('click','.user,.already-account,.sign-in',function(){
            $('.form').addClass('login-active').removeClass('sign-up-active')
        });

        $(document).on('click','.sign-up-btn,.sign-up',function(){
            $('.form').addClass('sign-up-active').removeClass('login-active')
        });

        $(document).on('click','.form-cancel',function(){
            $('.form').removeClass('login-active').removeClass('sign-up-active')
        });

        // Slider script
        $(document).ready(function(){
            $('#adaptive').lightSlider({
                adaptiveHeight:true,
                item:1,
                slideMargin:0,
                loop:true
            });
        })

            // Log in method to DB
            document.getElementById('login').addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = new FormData(event.target);
    const data = {};
    formData.forEach((value, key) => {
        data[key] = value;
    });

    // Send POST request to your API for sign in
    fetch('http://localhost:3000/api/v1/users/login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.token) {
            console.log('Sign in successful:', result);
            console.log('token is ',result.token);
            console.log('result is: ',result.isAdmin);
            
            // Save the token in local storage
            localStorage.setItem('token', result.token);

            if(result.isAdmin){
                alert(1);
                window.location.href = 'singIn.html'
            }
            // Redirect to the specified URL
            setTimeout(function() {
                // Redirect to the specified URL
                window.location.href = result.redirectUrl;
            }, 5000); // 5000 milliseconds = 5 seconds
             
        } else {
            console.log('Sign in failed:', result.message);
            alert('Wrong email or password. Please try again.');
        }
    })
    .catch(error => {
        console.error('Sign in failed:', error);
        alert('An error occurred during sign in. Please try again.');
    });
});

    
        
        // Register method
        document.getElementById('register').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            // Send POST request to your API
            fetch('http://localhost:3000/api/v1/users/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                console.log('Registration successful:', result);
                // Add your desired success handling here
                // Redirect to the sign-in page
                window.location.href = result.redirectUrl;
            })
            .catch(error => {
                console.error('Registration failed:', error);
                // Add your error handling here
            });
        });

           
    </script>


</body>
</html>